<tool id="lubridate_convert" name="Convertir des dates">
    <requirements>
        <requirement type="package" version="1.7.4">r-lubridate</requirement>
        <requirement type="package" version="1.12.2">r-data.table</requirement>
        <requirement type="package" version="0.8.0.1">r-dplyr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript '$__tool_directory__/lubridate.R' '$input' '$column' '$inputDateFormat' '$outputDateFormat' '$inputName'

    ]]></command>
    <inputs>
        <param format="tabular,csv,txt" name="input" type="data" label="Données d'entrée" />
        <param name="column" type="data_column" data_ref="input" multiple="false" value="2" label="Convertir la colonne" />
        <param name="inputDateFormat" type="select" label="dont le format de données est" help="A pour année, M pour mois et J pour jour">
            <option value="dmy">JMA</option>
            <option value="mdy">MJA</option>
            <option value="ymd" selected="true">AMJ</option>
        </param>
        <param name="inputName" type="text" value="date" label="dans une nouvelle colonne nommée" >
            <sanitizer invalid_char="_">
                <valid initial="default">
                    <add value="à" />
                    <add value="â" />
                    <add value="é" />
                    <add value="è" />
                    <add value="ê" />
                    <add value="ë" />
                    <add value="î" />
                    <add value="ï" />
                    <add value="ô" />
                    <add value="ù" />
                    <add value="û" />
                    <add value="ÿ" />
                    <add value="ç" />
                    <add value="œ" />
                    <add value="€" />
                </valid>
            </sanitizer>
        </param>
        <param name="outputDateFormat" type="select" label="où la date sera convertie en">
            <option value="full" selected="true">Date complète</option>
            <option value="year">Année</option>
            <option value="month">Mois</option>
            <option value="day">Jour</option>
            <option value="week">Semaine</option>
            <option value="yday">Jour de l'année (~1-365)</option>
            <option value="mday">Jour du mois (~1-30)</option>
            <option value="wday">Jour de la semaine (1-7)</option>
            <option value="timeZone">Fuseau horaire</option>
        </param>
    </inputs>
    <outputs>
        <data format="csv" name="output" from_work_dir="result"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="input-lubridate.csv"/>
            <param name="addToData" value="true"/>
            <param name="column" value="3"/>
            <param name="inputName" value="date"/>
            <param name="inputDateFormat" value="DMY"/>
            <param name="outputDateFormat" value="full"/>
            <output name="output" file="out-lubridate.tabular"/>
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

Cet outil permet de convertir des données dans un format de date souhaité.

Vous devez choisir le format d'entrée et le format de sortie de vos données.

**Exemple**

Données d'entrée ::

 ID   Date_Observation
 1   12/10/2019
 2   12.10.2019
 3   12-10-2019
 4 12//10//2019
 5   12/10*2019

 Paramètres :

 Ajouter le résultat au jeu de données initial : Non
 insert serie
 Numéro de la colonne d'entrée : 2
 Nom de la colonne résultante: Date
 Choisir le format des données d'entrée: JMA
 Choisir le format de sortie: Complet
 insert serie
 Numéro de la colonne d'entrée : 2
 Nom de la colonne résultante: Date
 Choisir le format des données d'entrée: JMA
 Choisir le format de sortie: Jour de l'année

 Name of the resulting column: Day of the year
 choose input date format: dmy
 choose output date format: Day of the year

Résultat ::

    date     Day of the year
 2019-10-12       285
 2019-10-12       285
 2019-10-12       285
 2019-10-12       285
 2019-10-12       285

    ]]></help>
</tool>
