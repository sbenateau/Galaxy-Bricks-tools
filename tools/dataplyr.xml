<tool id="dataplyr" name="Résumer des données">
    <description>en les aggrégeant</description>
    <requirements>
        <requirement type="package" version="1.12.2">r-data.table</requirement>
        <requirement type="package" version="0.8.0.1">r-dplyr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript '$__tool_directory__/dataplyr.R' '$input' '$groupBy' '$colOperation' '$function' '$nameCol'
        '$output'
        ]]>
    </command>
    <inputs>
        <param format="tabular,csv,txt" name="input" type="data" label="Données d'entrée" />
        <param name="groupBy" label="Regrouper toutes les lignes selon des catégories contenues dans les colonnes suivantes" type="data_column" data_ref="input" multiple="true" help="Attention seules les colonnes choisies seront présentes dans le fichier de sortie (le numéro d'oservation est souvent utile pour le premier regroupement)"/>
            <!-- put back multiple and checkbox when possible -->
            <param name="function" type="select" label="en faisant l'opération suivante">
                <option value="mean" selected="True">Moyenne</option>
                <option value="median">Médiane</option>
                <option value="sum">Somme</option>
                <option value="length">Compte</option>
                <option value="sd">Ecart-type</option>
                <option value="min">Minimum</option>
                <option value="max">Maximum</option>
            </param>
            <param name="colOperation" label="sur la colonne" type="data_column" data_ref="input" multiple="false"/>
            <param name="nameCol" label="et stoquer l'information dans une nouvelle colonne nommée" type="text" >
                <sanitizer invalid_char="_">
                    <valid initial="default">
                        <add value="à" />
                        <add value="â" />
                        <add value="é" />
                        <add value="è" />
                        <add value="ê" />
                        <add value="ë" />
                        <add value="î" />
                        <add value="ô" />
                        <add value="ï" />
                        <add value="ù" />
                        <add value="û" />
                        <add value="ÿ" />
                        <add value="ç" />
                        <add value="œ" />
                        <add value="€" />
                    </valid>
                </sanitizer>
            </param>
    </inputs>
    <outputs>
        <data format="csv" name="output" from_work_dir="output-dataplyr.tabular" />
    </outputs>
    <help><![CDATA[

.. class:: infomark

Cet outil permet de regrouper des lignes par catégorie (par type d'environnement par exemple) en faisant un calcul (une moyenne par exemple) sur les données d'une autre colonne.

Choisissez le jeu de données d'entrée, les colonnes sur lesquelles faire une agrégation, la colonne sur laquelle faire l'opération.

**Exemple**

Données d'entrée ::

  "Groupe"  "Nombre d'individus"
  escargot    0
  escargot    5
  limace      6
  limace      2

Paramètres :
Colonne pour agrégation = 1
Colonne pour opération = 2
Opération à effectuer = Moyenne et Maximum

Résultat ::

 "Groupe"  "Nombre d'individus" "Mean_Nombre d'individus" "Max_Nombre d'individus"
 escargot            0                    2.5                          5
 limace              6                      4                          6


    ]]></help>
</tool>
